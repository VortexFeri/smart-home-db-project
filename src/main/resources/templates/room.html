<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>

    <table>
        <thead>
        <tr>
            <th>Device</th>
            <th>Count</th>
            <th>Wattage</th>
            <th>Total for device</th>
            <th>  </th>
            <th>  </th>
        </tr>
        </thead>
        <tbody>
            <tr th:each="device : ${devicesList.deviceMap.entrySet()}">
                <td th:text="${device.key.name}"></td>
                <td th:text="${device.value}"></td>
                <td th:text="${device.key.wattage}"></td>
                <td th:text="${device.value * device.key.wattage}"></td>
                <td ><button th:id="${device.key.id+'DELETE'}"
                             th:onclick="'deleteDevice(\'' + ${device.key.id} + '\', \'' + ${roomid} + '\')'">Delete</button></td>

                <td ><button th:id="${device.key.id+'EDIT'}"
                             th:onclick="'editDevice(\'' + ${device.key.id} + '\', \'' + ${roomid} + '\')'">Edit</button></td>

            </tr>
        </tbody>
    </table>


    
    
</body>
<script>
    function deleteDevice(deviceId,roomid) {
        if (confirm('Are you sure you want to delete this device?')) {
            fetch('/rooms/'+ roomid+ '/delete-device/' + deviceId, {
                method: 'DELETE',
                headers: {
                    'Content-Type': 'application/json',
                    // You may need to include additional headers, such as authorization headers
                },
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // Handle the successful response (optional)
                console.log('Device deleted successfully');
                // Optionally, you can update the UI or refresh the page after successful deletion
            })
            .catch(error => {
                // Handle errors here
                console.error('Error during device deletion:', error);
            });
        }
    }

     function editDevice(deviceId,roomid) {
        // Prompt the user for a new value
        var newValue = prompt('Enter the new value for the device:');

        // If the user entered a value and didn't click cancel
        if (newValue !== null) {
            fetch('/rooms/'+ roomid+ '/edit-device/' + deviceId, {
                method: 'PUT', // Use PUT or PATCH depending on your API
                headers: {
                    'Content-Type': 'application/json',
                    // You may need to include additional headers, such as authorization headers
                },
                body: JSON.stringify({ newValue: newValue })
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                // Handle the successful response (optional)
                console.log('Device edited successfully');
                // Optionally, you can update the UI or refresh the page after successful edit
            })
            .catch(error => {
                // Handle errors here
                console.error('Error during device edit:', error);
            });
        }
    }
</script>

</html>